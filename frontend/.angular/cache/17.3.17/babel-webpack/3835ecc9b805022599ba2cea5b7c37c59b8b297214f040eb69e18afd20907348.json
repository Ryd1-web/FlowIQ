{"ast":null,"code":"import { ExpenseFormDialogComponent } from './expense-form-dialog.component';\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../core/services/expense.service\";\nimport * as i2 from \"../../core/services/business.service\";\nimport * as i3 from \"@angular/material/dialog\";\nimport * as i4 from \"@angular/material/snack-bar\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/material/table\";\nimport * as i7 from \"@angular/material/card\";\nimport * as i8 from \"@angular/material/progress-spinner\";\nimport * as i9 from \"@angular/material/icon\";\nimport * as i10 from \"@angular/material/button\";\nimport * as i11 from \"@angular/material/menu\";\nfunction ExpenseManagementComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵelement(1, \"mat-spinner\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ExpenseManagementComponent_div_1_th_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 21);\n    i0.ɵɵtext(1, \"Date\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ExpenseManagementComponent_div_1_td_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"date\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const row_r3 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(2, 1, row_r3.date, \"mediumDate\"));\n  }\n}\nfunction ExpenseManagementComponent_div_1_th_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 21);\n    i0.ɵɵtext(1, \"Category\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ExpenseManagementComponent_div_1_td_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const row_r4 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(row_r4.category);\n  }\n}\nfunction ExpenseManagementComponent_div_1_th_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 21);\n    i0.ɵɵtext(1, \"Amount\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ExpenseManagementComponent_div_1_td_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 23);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const row_r5 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(2, 1, row_r5.amount, \"1.0-0\"));\n  }\n}\nfunction ExpenseManagementComponent_div_1_th_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 21);\n    i0.ɵɵtext(1, \"Description\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ExpenseManagementComponent_div_1_td_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const row_r6 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(row_r6.description || \"-\");\n  }\n}\nfunction ExpenseManagementComponent_div_1_th_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 21);\n    i0.ɵɵtext(1, \"Action\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ExpenseManagementComponent_div_1_td_23_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"td\", 22)(1, \"button\", 24)(2, \"mat-icon\");\n    i0.ɵɵtext(3, \"visibility\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"mat-menu\", null, 0)(6, \"button\", 25);\n    i0.ɵɵlistener(\"click\", function ExpenseManagementComponent_div_1_td_23_Template_button_click_6_listener() {\n      const row_r8 = i0.ɵɵrestoreView(_r7).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.openEditDialog(row_r8));\n    });\n    i0.ɵɵelementStart(7, \"mat-icon\");\n    i0.ɵɵtext(8, \"edit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"span\");\n    i0.ɵɵtext(10, \"Edit\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"button\", 25);\n    i0.ɵɵlistener(\"click\", function ExpenseManagementComponent_div_1_td_23_Template_button_click_11_listener() {\n      const row_r8 = i0.ɵɵrestoreView(_r7).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.openDeleteDialog(row_r8));\n    });\n    i0.ɵɵelementStart(12, \"mat-icon\");\n    i0.ɵɵtext(13, \"delete\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"span\");\n    i0.ɵɵtext(15, \"Delete\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const actionMenu_r9 = i0.ɵɵreference(5);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"matMenuTriggerFor\", actionMenu_r9);\n  }\n}\nfunction ExpenseManagementComponent_div_1_tr_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 26);\n  }\n}\nfunction ExpenseManagementComponent_div_1_tr_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 27);\n  }\n}\nfunction ExpenseManagementComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 5)(1, \"mat-card\", 6)(2, \"div\", 7)(3, \"h2\");\n    i0.ɵɵtext(4, \"Expense Records\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function ExpenseManagementComponent_div_1_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.openAddDialog());\n    });\n    i0.ɵɵtext(6, \"Add Expense\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 9)(8, \"table\", 10);\n    i0.ɵɵelementContainerStart(9, 11);\n    i0.ɵɵtemplate(10, ExpenseManagementComponent_div_1_th_10_Template, 2, 0, \"th\", 12)(11, ExpenseManagementComponent_div_1_td_11_Template, 3, 4, \"td\", 13);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementContainerStart(12, 14);\n    i0.ɵɵtemplate(13, ExpenseManagementComponent_div_1_th_13_Template, 2, 0, \"th\", 12)(14, ExpenseManagementComponent_div_1_td_14_Template, 2, 1, \"td\", 13);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementContainerStart(15, 15);\n    i0.ɵɵtemplate(16, ExpenseManagementComponent_div_1_th_16_Template, 2, 0, \"th\", 12)(17, ExpenseManagementComponent_div_1_td_17_Template, 3, 4, \"td\", 16);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementContainerStart(18, 17);\n    i0.ɵɵtemplate(19, ExpenseManagementComponent_div_1_th_19_Template, 2, 0, \"th\", 12)(20, ExpenseManagementComponent_div_1_td_20_Template, 2, 1, \"td\", 13);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementContainerStart(21, 18);\n    i0.ɵɵtemplate(22, ExpenseManagementComponent_div_1_th_22_Template, 2, 0, \"th\", 12)(23, ExpenseManagementComponent_div_1_td_23_Template, 16, 1, \"td\", 13);\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵtemplate(24, ExpenseManagementComponent_div_1_tr_24_Template, 1, 0, \"tr\", 19)(25, ExpenseManagementComponent_div_1_tr_25_Template, 1, 0, \"tr\", 20);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"dataSource\", ctx_r1.records);\n    i0.ɵɵadvance(16);\n    i0.ɵɵproperty(\"matHeaderRowDef\", ctx_r1.displayedColumns);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"matRowDefColumns\", ctx_r1.displayedColumns);\n  }\n}\nfunction ExpenseManagementComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 28)(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"error\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.error, \"\\n\");\n  }\n}\nexport let ExpenseManagementComponent = /*#__PURE__*/(() => {\n  class ExpenseManagementComponent {\n    expenseService;\n    businessService;\n    dialog;\n    snackBar;\n    displayedColumns = ['date', 'category', 'amount', 'description', 'action'];\n    records = [];\n    loading = true;\n    error = '';\n    businessId = '';\n    categories = [{\n      label: 'Rent',\n      value: 1\n    }, {\n      label: 'Salary',\n      value: 2\n    }, {\n      label: 'Supplies',\n      value: 3\n    }, {\n      label: 'Transport',\n      value: 4\n    }, {\n      label: 'Food',\n      value: 5\n    }, {\n      label: 'Utilities',\n      value: 6\n    }, {\n      label: 'Marketing',\n      value: 7\n    }, {\n      label: 'Maintenance',\n      value: 8\n    }, {\n      label: 'Tax',\n      value: 9\n    }, {\n      label: 'Loan',\n      value: 10\n    }, {\n      label: 'Inventory',\n      value: 11\n    }, {\n      label: 'Equipment',\n      value: 12\n    }, {\n      label: 'Other',\n      value: 13\n    }];\n    constructor(expenseService, businessService, dialog, snackBar) {\n      this.expenseService = expenseService;\n      this.businessService = businessService;\n      this.dialog = dialog;\n      this.snackBar = snackBar;\n    }\n    ngOnInit() {\n      this.businessService.getAllForCurrentUser().subscribe({\n        next: businesses => {\n          if (!businesses.length) {\n            this.error = 'No business found for this user.';\n            this.loading = false;\n            return;\n          }\n          this.businessId = businesses[0].id;\n          this.loadRecords();\n        },\n        error: () => {\n          this.error = 'Failed to load business context.';\n          this.loading = false;\n        }\n      });\n    }\n    loadRecords() {\n      this.loading = true;\n      this.expenseService.getAll(this.businessId).subscribe({\n        next: rows => {\n          this.records = rows.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n          this.loading = false;\n        },\n        error: () => {\n          this.error = 'Failed to load expense records.';\n          this.loading = false;\n        }\n      });\n    }\n    openAddDialog() {\n      const dialogRef = this.dialog.open(ExpenseFormDialogComponent, {\n        width: '520px',\n        data: {\n          title: 'Add Expense',\n          categories: this.categories\n        }\n      });\n      dialogRef.afterClosed().subscribe(payload => {\n        if (!payload) {\n          return;\n        }\n        this.expenseService.add(this.businessId, payload).subscribe({\n          next: () => {\n            this.showAlert('Expense added successfully.', 'success');\n            this.loadRecords();\n          },\n          error: () => {\n            this.showAlert('Failed to add expense.', 'error');\n          }\n        });\n      });\n    }\n    openEditDialog(row) {\n      const dialogRef = this.dialog.open(ExpenseFormDialogComponent, {\n        width: '520px',\n        data: {\n          title: 'Edit Expense',\n          record: row,\n          categories: this.categories\n        }\n      });\n      dialogRef.afterClosed().subscribe(payload => {\n        if (!payload || !row.id) {\n          return;\n        }\n        this.expenseService.update(this.businessId, row.id, payload).subscribe({\n          next: () => {\n            this.showAlert('Expense updated successfully.', 'success');\n            this.loadRecords();\n          },\n          error: () => {\n            this.showAlert('Failed to update expense.', 'error');\n          }\n        });\n      });\n    }\n    openDeleteDialog(row) {\n      if (!row.id) {\n        return;\n      }\n      const dialogRef = this.dialog.open(ConfirmDialogComponent, {\n        width: '420px',\n        data: {\n          title: 'Delete Expense',\n          message: 'Are you sure you want to delete this expense record?',\n          yesText: 'Yes',\n          noText: 'No'\n        }\n      });\n      dialogRef.afterClosed().subscribe(confirmed => {\n        if (!confirmed) {\n          return;\n        }\n        this.expenseService.delete(this.businessId, row.id).subscribe({\n          next: () => {\n            this.showAlert('Expense deleted successfully.', 'success');\n            this.loadRecords();\n          },\n          error: () => {\n            this.showAlert('Failed to delete expense.', 'error');\n          }\n        });\n      });\n    }\n    showAlert(message, type) {\n      this.snackBar.open(message, 'Close', {\n        duration: 3000,\n        panelClass: type === 'success' ? 'success-snackbar' : 'error-snackbar'\n      });\n    }\n    static ɵfac = function ExpenseManagementComponent_Factory(t) {\n      return new (t || ExpenseManagementComponent)(i0.ɵɵdirectiveInject(i1.ExpenseService), i0.ɵɵdirectiveInject(i2.BusinessService), i0.ɵɵdirectiveInject(i3.MatDialog), i0.ɵɵdirectiveInject(i4.MatSnackBar));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ExpenseManagementComponent,\n      selectors: [[\"app-expense-management\"]],\n      decls: 3,\n      vars: 3,\n      consts: [[\"actionMenu\", \"matMenu\"], [\"class\", \"transactions-loading\", 4, \"ngIf\"], [\"class\", \"management-page\", 4, \"ngIf\"], [\"class\", \"transactions-error\", 4, \"ngIf\"], [1, \"transactions-loading\"], [1, \"management-page\"], [1, \"management-table-card\", \"full-span\"], [1, \"header-row\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"type\", \"button\", 3, \"click\"], [1, \"table-wrap\"], [\"mat-table\", \"\", 3, \"dataSource\"], [\"matColumnDef\", \"date\"], [\"mat-header-cell\", \"\", 4, \"matHeaderCellDef\"], [\"mat-cell\", \"\", 4, \"matCellDef\"], [\"matColumnDef\", \"category\"], [\"matColumnDef\", \"amount\"], [\"mat-cell\", \"\", \"class\", \"amount-expense\", 4, \"matCellDef\"], [\"matColumnDef\", \"description\"], [\"matColumnDef\", \"action\"], [\"mat-header-row\", \"\", 4, \"matHeaderRowDef\"], [\"mat-row\", \"\", 4, \"matRowDef\", \"matRowDefColumns\"], [\"mat-header-cell\", \"\"], [\"mat-cell\", \"\"], [\"mat-cell\", \"\", 1, \"amount-expense\"], [\"mat-icon-button\", \"\", \"type\", \"button\", 3, \"matMenuTriggerFor\"], [\"mat-menu-item\", \"\", \"type\", \"button\", 3, \"click\"], [\"mat-header-row\", \"\"], [\"mat-row\", \"\"], [1, \"transactions-error\"]],\n      template: function ExpenseManagementComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵtemplate(0, ExpenseManagementComponent_div_0_Template, 2, 0, \"div\", 1)(1, ExpenseManagementComponent_div_1_Template, 26, 3, \"div\", 2)(2, ExpenseManagementComponent_div_2_Template, 4, 1, \"div\", 3);\n        }\n        if (rf & 2) {\n          i0.ɵɵproperty(\"ngIf\", ctx.loading);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", !ctx.loading && !ctx.error);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.error);\n        }\n      },\n      dependencies: [i5.NgIf, i6.MatTable, i6.MatHeaderCellDef, i6.MatHeaderRowDef, i6.MatColumnDef, i6.MatCellDef, i6.MatRowDef, i6.MatHeaderCell, i6.MatCell, i6.MatHeaderRow, i6.MatRow, i7.MatCard, i8.MatProgressSpinner, i9.MatIcon, i10.MatButton, i10.MatIconButton, i11.MatMenu, i11.MatMenuItem, i11.MatMenuTrigger, i5.DecimalPipe, i5.DatePipe],\n      styles: [\".management-page[_ngcontent-%COMP%]{display:block}.management-table-card[_ngcontent-%COMP%]{border-radius:16px;border:1px solid var(--border-soft)}.management-table-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-family:var(--font-heading)}.full-span[_ngcontent-%COMP%]{width:100%}.header-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}.dialog-form[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:12px;min-width:320px}.table-wrap[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;min-width:700px}.amount-income[_ngcontent-%COMP%]{color:#16a34a;font-weight:600}.amount-expense[_ngcontent-%COMP%]{color:#dc2626;font-weight:600}@media (max-width: 960px){.header-row[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}\"]\n    });\n  }\n  return ExpenseManagementComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}