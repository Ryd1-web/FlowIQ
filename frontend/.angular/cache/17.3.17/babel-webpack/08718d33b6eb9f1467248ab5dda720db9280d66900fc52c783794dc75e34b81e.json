{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nlet ExpenseManagementComponent = class ExpenseManagementComponent {\n  fb;\n  expenseService;\n  businessService;\n  records = [];\n  loading = true;\n  error = '';\n  businessId = '';\n  editingId = null;\n  categories = [{\n    label: 'Rent',\n    value: 1\n  }, {\n    label: 'Salary',\n    value: 2\n  }, {\n    label: 'Supplies',\n    value: 3\n  }, {\n    label: 'Transport',\n    value: 4\n  }, {\n    label: 'Food',\n    value: 5\n  }, {\n    label: 'Utilities',\n    value: 6\n  }, {\n    label: 'Marketing',\n    value: 7\n  }, {\n    label: 'Maintenance',\n    value: 8\n  }, {\n    label: 'Tax',\n    value: 9\n  }, {\n    label: 'Loan',\n    value: 10\n  }, {\n    label: 'Inventory',\n    value: 11\n  }, {\n    label: 'Equipment',\n    value: 12\n  }, {\n    label: 'Other',\n    value: 13\n  }];\n  form = this.fb.group({\n    amount: [0, [Validators.required, Validators.min(1)]],\n    category: [13, Validators.required],\n    date: ['', Validators.required],\n    description: ['', [Validators.required, Validators.maxLength(200)]]\n  });\n  constructor(fb, expenseService, businessService) {\n    this.fb = fb;\n    this.expenseService = expenseService;\n    this.businessService = businessService;\n  }\n  ngOnInit() {\n    this.businessService.getAllForCurrentUser().subscribe({\n      next: businesses => {\n        if (!businesses.length) {\n          this.error = 'No business found for this user.';\n          this.loading = false;\n          return;\n        }\n        this.businessId = businesses[0].id;\n        this.loadRecords();\n      },\n      error: () => {\n        this.error = 'Failed to load business context.';\n        this.loading = false;\n      }\n    });\n  }\n  loadRecords() {\n    this.loading = true;\n    this.expenseService.getAll(this.businessId).subscribe({\n      next: rows => {\n        this.records = rows.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n        this.loading = false;\n      },\n      error: () => {\n        this.error = 'Failed to load expense records.';\n        this.loading = false;\n      }\n    });\n  }\n  edit(row) {\n    this.editingId = row.id ?? null;\n    this.form.patchValue({\n      amount: row.amount,\n      category: this.findCategoryValue(row.category),\n      date: this.toDateInput(row.date),\n      description: row.description ?? ''\n    });\n  }\n  cancelEdit() {\n    this.editingId = null;\n    this.form.reset({\n      amount: 0,\n      category: 13,\n      date: '',\n      description: ''\n    });\n  }\n  save() {\n    if (this.form.invalid || !this.businessId) {\n      this.form.markAllAsTouched();\n      return;\n    }\n    const value = this.form.getRawValue();\n    const payload = {\n      id: this.editingId ?? undefined,\n      amount: Number(value.amount),\n      date: value.date ?? '',\n      type: 'Expense',\n      category: String(value.category ?? 13),\n      description: value.description ?? ''\n    };\n    const request$ = this.editingId ? this.expenseService.update(this.businessId, this.editingId, payload) : this.expenseService.add(this.businessId, payload);\n    request$.subscribe({\n      next: () => {\n        this.cancelEdit();\n        this.loadRecords();\n      },\n      error: () => {\n        this.error = this.editingId ? 'Failed to update expense.' : 'Failed to add expense.';\n      }\n    });\n  }\n  findCategoryValue(category) {\n    const numeric = Number(category);\n    if (!Number.isNaN(numeric) && numeric > 0) {\n      return numeric;\n    }\n    const match = this.categories.find(x => x.label.toLowerCase() === (category || '').toLowerCase());\n    return match?.value ?? 13;\n  }\n  toDateInput(value) {\n    const d = new Date(value);\n    if (Number.isNaN(d.getTime())) {\n      return '';\n    }\n    return d.toISOString().split('T')[0];\n  }\n};\nExpenseManagementComponent = __decorate([Component({\n  selector: 'app-expense-management',\n  templateUrl: './expense-management.component.html',\n  styleUrls: ['./management.component.scss']\n})], ExpenseManagementComponent);\nexport { ExpenseManagementComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}