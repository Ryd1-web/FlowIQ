{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nlet IncomeManagementComponent = class IncomeManagementComponent {\n  fb;\n  incomeService;\n  businessService;\n  records = [];\n  loading = true;\n  error = '';\n  businessId = '';\n  editingId = null;\n  form = this.fb.group({\n    amount: [0, [Validators.required, Validators.min(1)]],\n    source: ['', [Validators.required, Validators.maxLength(100)]],\n    date: ['', Validators.required],\n    notes: ['']\n  });\n  constructor(fb, incomeService, businessService) {\n    this.fb = fb;\n    this.incomeService = incomeService;\n    this.businessService = businessService;\n  }\n  ngOnInit() {\n    this.businessService.getAllForCurrentUser().subscribe({\n      next: businesses => {\n        if (!businesses.length) {\n          this.error = 'No business found for this user.';\n          this.loading = false;\n          return;\n        }\n        this.businessId = businesses[0].id;\n        this.loadRecords();\n      },\n      error: () => {\n        this.error = 'Failed to load business context.';\n        this.loading = false;\n      }\n    });\n  }\n  loadRecords() {\n    this.loading = true;\n    this.incomeService.getAll(this.businessId).subscribe({\n      next: rows => {\n        this.records = rows.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n        this.loading = false;\n      },\n      error: () => {\n        this.error = 'Failed to load income records.';\n        this.loading = false;\n      }\n    });\n  }\n  edit(row) {\n    this.editingId = row.id ?? null;\n    this.form.patchValue({\n      amount: row.amount,\n      source: row.category,\n      date: this.toDateInput(row.date),\n      notes: row.description ?? ''\n    });\n  }\n  cancelEdit() {\n    this.editingId = null;\n    this.form.reset({\n      amount: 0,\n      source: '',\n      date: '',\n      notes: ''\n    });\n  }\n  save() {\n    if (this.form.invalid || !this.businessId) {\n      this.form.markAllAsTouched();\n      return;\n    }\n    const value = this.form.getRawValue();\n    const payload = {\n      id: this.editingId ?? undefined,\n      amount: Number(value.amount),\n      date: value.date ?? '',\n      type: 'Income',\n      category: value.source ?? '',\n      description: value.notes ?? ''\n    };\n    const request$ = this.editingId ? this.incomeService.update(this.businessId, this.editingId, payload) : this.incomeService.add(this.businessId, payload);\n    request$.subscribe({\n      next: () => {\n        this.cancelEdit();\n        this.loadRecords();\n      },\n      error: () => {\n        this.error = this.editingId ? 'Failed to update income.' : 'Failed to add income.';\n      }\n    });\n  }\n  toDateInput(value) {\n    const d = new Date(value);\n    if (Number.isNaN(d.getTime())) {\n      return '';\n    }\n    return d.toISOString().split('T')[0];\n  }\n};\nIncomeManagementComponent = __decorate([Component({\n  selector: 'app-income-management',\n  templateUrl: './income-management.component.html',\n  styleUrls: ['./management.component.scss']\n})], IncomeManagementComponent);\nexport { IncomeManagementComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}